name: Process PDF with OCRmyPDF

on:
  workflow_dispatch:
    inputs:
      input_file:
        description: 'Input PDF file name from /input/ folder'
        required: true
      additional_param:  
        description: 'Additional parameter(s)'
        required: false
        default: -l tha+eng

permissions:
  contents: write

jobs:
  process_pdf:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install OCRmyPDF and Tesseract
      run: |
        sudo apt-get update
        sudo apt-get install -y ocrmypdf
        sudo apt-get install -y tesseract-ocr-tha

    - name: Create output directory
      run: mkdir -p ./output

    - name: Process PDF
      run: |
        ocrmypdf ${{ github.event.inputs.additional_param }} --skip-text --clean --sidecar ./output/output_OCRmyPDF.txt ./input/${{ github.event.inputs.input_file }} ./output/output_OCRmyPDF.pdf

    # https://ocrmypdf.readthedocs.io/en/latest/cookbook.html

    - name: Upload output PDF
      uses: actions/upload-artifact@v4
      with:
        name: output-pdf
        path: ./output/*
        retention-days: 7
